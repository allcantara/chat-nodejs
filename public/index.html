<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Node.JS</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <form id="chat">
        <input type="text" name="username" placeholder="Informe seu usuÃ¡rio..." />
        <div class="messages"></div>
        <input type="text" name="message" placeholder="Digite aqui sua mensagem..." />
        <button type="submit">ENVIAR</button>
    </form>

    <script text="text/javascript">
        const socket = io('http://localhost:3000')
        const color = randomColor()

        const renderMessage = ({ author, message, color }) => {
            $('.messages').append(`
                <div class="message">
                    <strong style="color:${color}">>> ${author.toUpperCase()}:  </strong> ${message}
                </div>`
            )
        }

        socket.on('previousMessages', messages => {
            messages.map(data => renderMessage(data))
        })

        socket.on('receivedMessage', message => {
            renderMessage(message)
        })
        
        $('#chat').submit(function(event) {
            event.preventDefault()
            var author = $('input[name=username]').val()
            var message = $('input[name=message]').val()

            if(author.length && message.length) {
                var messageObject = {
                    author,
                    message,
                    color,
                }
                socket.emit('sendMessage', messageObject)
                renderMessage(messageObject)
            }
        })

        function randomColor() {
            var hexadecimais = '0123456789ABCDEF'
            var cor = '#'
            for (var i = 0; i < 6; i++ ) {
                cor += hexadecimais[Math.floor(Math.random() * 16)]
            }
            return cor
        }

    </script>
</body>
</html>